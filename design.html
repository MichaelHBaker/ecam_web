<!DOCTYPE html>
<html>
<head>
    <title>Django Models ERD</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .diagram-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
    </style>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            er: {
                diagramPadding: 20,
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                useMaxWidth: true
            }
        });
    </script>
</head>
<body>
    <h1>Django Models Entity Relationship Diagram</h1>
    <div class="diagram-container">
        <div class="mermaid">
erDiagram
    MeasurementCategory ||--o{ MeasurementType : "has"
    MeasurementType ||--o{ MeasurementUnit : "has"
    MeasurementType ||--o{ Measurement : "type_of"
    MeasurementUnit ||--o{ Measurement : "unit_for"
    
    Project ||--o{ Location : "has"
    Location ||--o{ Measurement : "contains"
    
    DataSource ||--o{ Dataset : "provides"
    DataSource ||--o{ DataSourceLocation : "linked_to"
    Location ||--o{ DataSourceLocation : "linked_from"
    
    Dataset ||--o{ SourceColumn : "has"
    Dataset ||--o{ DataImport : "imports"
    DataImport ||--o{ ImportBatch : "processed_in"
    
    SourceColumn ||--o{ ColumnMapping : "mapped_from"
    Measurement ||--o{ ColumnMapping : "mapped_to"
    Measurement ||--o{ TimeSeriesData : "records"

    MeasurementCategory {
        string name
        string display_name
        text description
    }

    MeasurementType {
        string name
        text description
        boolean supports_multipliers
    }

    MeasurementUnit {
        string name
        text description
        float conversion_factor
        boolean is_base_unit
    }

    Project {
        string name
        string project_type
        date start_date
        date end_date
    }

    Location {
        string name
        text address
        decimal latitude
        decimal longitude
    }

    Measurement {
        string name
        text description
        string multiplier
        string source_timezone
    }

    DataSource {
        string name
        string source_type
        string middleware_type
        string auth_type
        url url_base
        json connection_config
    }

    Dataset {
        string name
        text description
        string source_timezone
        json import_config
    }

    SourceColumn {
        string name
        integer position
        string data_type
        string timestamp_role
        json sample_data
    }

    ColumnMapping {
        json transform_config
        json validation_rules
    }

    TimeSeriesData {
        datetime timestamp
        float value
    }
        </div>
    </div>
</body>
</html>