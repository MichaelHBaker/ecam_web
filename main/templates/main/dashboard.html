{% extends 'base.html' %}

{% block title %}ECAM Web{% endblock %}

{% block extra_css %}
<!-- Additional CSS can be added here if required -->
<style>
    /* Shift dropdown to the left by its own width */
    .w3-dropdown-hover .w3-dropdown-content {
        transform: translateX(-10%);
        right: 0; /* Ensure it aligns to the right side of the button */
    }
</style>
{% endblock %}

{% block content %}

<!-- locations Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('locations')" class="w3-bar-item w3-button">
        <i id="chevronIcon-locations" class="bi bi-chevron-right"></i> Locations
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'locations' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportLocations()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="locations" class="w3-container w3-hide">
    <!-- Client Table -->
    <table class="w3-table w3-striped w3-hoverable w3-white">
        <thead>
            <tr class="w3-light-grey">
                <th>Name</th>
                <th>Contact Email</th>
                <th>Phone Number</th>
            </tr>
        </thead>
        <tbody>
            {% for form in client_formset %}
            <tr onclick="loadProjectsForClient('{{ form.instance.id }}')">
                <td>{{ form.name }}</td>
                <td>{{ form.contact_email }}</td>
                <td>{{ form.phone_number }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Projects Table -->
    <div id="projectsContainer" class="w3-responsive">
        <table class="w3-table w3-striped w3-bordered w3-hoverable w3-white">
            <thead>
                <tr class="w3-light-grey">
                    <th>Name</th>
                    <th>Project Type</th>
                    <th>Start Date</th>
                </tr>
            </thead>
            <tbody>
                <!-- Projects will be dynamically inserted here -->
            </tbody>
        </table>
    </div>
</div>



<!-- Measurements Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('measurements')" class="w3-bar-item w3-button">
        <i id="chevronIcon-measurements" class="bi bi-chevron-right"></i> measurements
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'measurements' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportmeasurements()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="measurements" class="w3-container w3-hide">
    <p>Some text about measurements.</p>
</div>

<!-- Data Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('data')" class="w3-bar-item w3-button">
        <i id="chevronIcon-data" class="bi bi-chevron-right"></i> data
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'data' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdata()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="data" class="w3-container w3-hide">
    <p>Some text about data.</p>
</div>

<!-- Dictionary Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('dictionary')" class="w3-bar-item w3-button">
        <i id="chevronIcon-dictionary" class="bi bi-chevron-right"></i> dictionary
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'dictionary' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdictionary()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="dictionary" class="w3-container w3-hide">
    <p>Some text about dictionary.</p>
</div>


{% endblock %}

{% block extra_js %}
<script>
    function toggleOpenClose(id) {
        var div = document.getElementById(id);
        var icon = document.getElementById('chevronIcon-' + id);
        if (div.classList.contains("w3-show")) {
            div.classList.remove("w3-show");
            div.classList.add("w3-hide");
            icon.className = "bi bi-chevron-right";
        } else {
            div.classList.remove("w3-hide");
            div.classList.add("w3-show");
            icon.className = "bi bi-chevron-down";
        }
    }
    
    function loadProjectsForClient(clientId) {
        const url = `/load-projects-for-client/${clientId}`; // Ensure the URL matches your Django URLconf
        fetch(url)
        .then(response => response.json())
        .then(data => {
            const projectsContainer = document.getElementById('projectsContainer').querySelector('tbody');
            projectsContainer.innerHTML = ''; // Clear previous projects
            data.projects.forEach(project => {
                const row = `<tr>
                                <td>${project.name}</td>
                                <td>${project.project_type}</td>
                                <td>${project.start_date}</td>
                            </tr>`;
                projectsContainer.innerHTML += row;
            });
        })
        .catch(error => console.error('Error loading projects:', error));
    }
    
</script>
{% endblock %}
