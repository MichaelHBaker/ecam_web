{% extends 'base.html' %}

{% block title %}ECAM Web{% endblock %}

{% block extra_css %}
<!-- Additional CSS can be added here if required -->
<style>
    /* Shift dropdown to the left by its own width */
    .w3-dropdown-hover .w3-dropdown-content {
        transform: translateX(-10%);
        right: 0; /* Ensure it aligns to the right side of the button */
    }

    
    .tree-container ul {
        list-style-type: none;
        padding-left: 20px;
    }
    
    .caret {
        cursor: pointer;
        user-select: none;
        padding: 4px 8px;
    }
    
    .caret::before {
        content: "\25B6";
        color: black;
        display: inline-block;
        margin-right: 6px;
    }
    
    .caret-down::before {
        transform: rotate(90deg);
    }
    
    .nested {
        display: none;
    }
    
    .active {
        display: block;
    }
    
    .tree-item {
        display: flex;
        align-items: center;
        padding: 4px;
    }
    
    .tree-item:hover {
        background-color: #f1f1f1;
    }
    
    .item-actions {
        display: none;
        margin-left: 8px;
    }
    
    .tree-item:hover .item-actions {
        display: inline-block;
            
</style>
{% endblock %}

{% block content %}

<!-- location Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">
    <span onclick="w3_open_container('location')" style="cursor:pointer">
        <i class="bi bi-chevron-right"></i> Location
    </span>
    <div class="w3-dropdown-hover w3-right">
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'location' %}" class="w3-bar-item w3-button">Full Page</a>
            <a href="#" class="w3-bar-item w3-button" onclick="exportLocation()">Export</a>
        </div>
    </div>
</div>
<div id="location" class="w3-container w3-hide">
    {% for client in clients %}
    <div class="tree-item">
        <span class="caret">{{ client.name }}</span>
        <ul class="nested">
            {% for project in client.project.all %}
            <li>
                <span class="caret">{{ project.name }} ({{ project.get_project_type_display }})</span>
                <ul class="nested">
                    {% for location in project.location.all %}
                        {% if not location.parent %}
                        <li>
                            {% include "main/location_tree_item.html" with location=location %}
                        </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
</div>

<!-- Measurement Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('measurement')" class="w3-bar-item w3-button">
        <i id="chevronIcon-measurement" class="bi bi-chevron-right"></i> measurement
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'measurement' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportmeasurement()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="measurement" class="w3-container w3-hide">
    <p>Some text about measurement.</p>
</div>

<!-- Data Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('data')" class="w3-bar-item w3-button">
        <i id="chevronIcon-data" class="bi bi-chevron-right"></i> data
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'data' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdata()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="data" class="w3-container w3-hide">
    <p>Some text about data.</p>
</div>

<!-- Dictionary Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('dictionary')" class="w3-bar-item w3-button">
        <i id="chevronIcon-dictionary" class="bi bi-chevron-right"></i> dictionary
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'dictionary' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdictionary()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="dictionary" class="w3-container w3-hide">
    <p>Some text about dictionary.</p>
</div>


{% endblock %}

{% block extra_js %}
<script>
    function toggleOpenClose(id) {
        var div = document.getElementById(id);
        var icon = document.getElementById('chevronIcon-' + id);
        if (div.classList.contains("w3-show")) {
            div.classList.remove("w3-show");
            div.classList.add("w3-hide");
            icon.className = "bi bi-chevron-right";
        } else {
            div.classList.remove("w3-hide");
            div.classList.add("w3-show");
            icon.className = "bi bi-chevron-down";
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tree toggles
        var toggler = document.getElementsByClassName("caret");
        for (var i = 0; i < toggler.length; i++) {
            toggler[i].addEventListener("click", function(e) {
                e.stopPropagation();
                this.parentElement.querySelector(".nested").classList.toggle("active");
                this.classList.toggle("caret-down");
            });
        }
    });    
    function w3_open_container(containerName) {
        // Toggle arrows for all container titles
        var containers = document.getElementsByClassName("w3-bar");
        for (var i = 0; i < containers.length; i++) {
            var titleSpan = containers[i].querySelector('span');
            var icon = titleSpan ? titleSpan.querySelector('i') : null;
            if (icon) {
                if (titleSpan.onclick && titleSpan.onclick.toString().includes(containerName)) {
                    // This is the clicked container
                    if (document.getElementById(containerName).classList.contains("w3-hide")) {
                        icon.classList.remove('bi-chevron-right');
                        icon.classList.add('bi-chevron-down');
                    } else {
                        icon.classList.remove('bi-chevron-down');
                        icon.classList.add('bi-chevron-right');
                    }
                } else {
                    // Reset other containers
                    icon.classList.remove('bi-chevron-down');
                    icon.classList.add('bi-chevron-right');
                }
            }
        }
    
        // Toggle container visibility
        var containers = document.getElementsByClassName("w3-container");
        for (var i = 0; i < containers.length; i++) {
            if (containers[i].id !== containerName) {
                containers[i].classList.add("w3-hide");
            }
        }
        var x = document.getElementById(containerName);
        if (x.classList.contains("w3-hide")) {
            x.classList.remove("w3-hide");
        } else {
            x.classList.add("w3-hide");
        }
    }</script>
{% endblock %}
