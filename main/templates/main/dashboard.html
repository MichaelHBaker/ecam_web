{% extends 'base.html' %}

{% block title %}ECAM Web{% endblock %}

{% block extra_css %}
<!-- Additional CSS can be added here if required -->
<style>
    /* Shift dropdown to the left by its own width */
    .w3-dropdown-hover .w3-dropdown-content {
        transform: translateX(-10%);
        right: 0; /* Ensure it aligns to the right side of the button */
    }

    
    .tree-container ul {
        list-style-type: none;
        padding-left: 20px;
    }
    
    .tree-headings {
        padding-left: 20px;
    }
    .tree-heading-before {
        padding-left: 6px;
    }
    .caret {
        cursor: pointer;
        user-select: none;
        padding: 4px 8px;
    }
    
    .caret::before {
        content: "\25B6";
        color: black;
        display: inline-block;
        margin-right: 6px;
    }
    
    .caret-down::before {
        transform: rotate(90deg);
    }
    
    .nested {
        display: none;
    }
    
    .active {
        display: block;
    }

    .tree-item {
        display: flex;
        flex-direction: column; /* Stack items vertically */
        align-items: flex-start; /* Align items to the left */
        padding: 4px;
        padding-left: 20px; /* Indent for tree structure */
    }
    
    .tree-item-row {
        display: flex;
        align-items: center; /* Align button and three dots vertically */
        justify-content: space-between; /* Space between button and three dots */
        width: 100%; /* Full width for alignment */
        position: relative; /* Ensure relative positioning for hover effects */
    }
    
    .tree-item-row > button {
        text-align: left; /* Align button text to the left */
        flex: 1; /* Allow the button to take available space */
        border: none;
        background: none; /* Remove default button background */
    }
    
    .tree-item-row > .item-actions {
        display: none; /* Hide three dots by default */
        margin-left: 8px; /* Add space between button and three dots */
    }
    
    .tree-item-row:hover > .item-actions {
        display: inline-block; /* Show three dots on hover */
    }
    
    .item-actions > .w3-button {
        border: none;
        background: none; /* Remove default button styles */
    }
    
    .w3-dropdown-content {
        display: none; /* Hide dropdown by default */
        position: absolute;
        top: 100%; /* Position dropdown below the three dots */
        right: 0; /* Align dropdown to the right */
        background-color: white; /* Dropdown background */
        border: 1px solid #ddd; /* Border for dropdown */
        z-index: 10; /* Ensure dropdown appears above other content */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Subtle shadow for dropdown */
        width: 150px; /* Fixed width for dropdown */
    }
    
    .item-actions:hover .w3-dropdown-content {
        display: block; /* Show dropdown on hover */
    }
    
    .tree-item:hover {
        background-color: #f1f1f1; /* Highlight tree-item on hover */
    }
                                        
    {% comment %} .tree-item {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 4px;
    }

    .tree-item:hover {
        background-color: #f1f1f1;
    }
    
    .item-actions {
        display: none;
        margin-left: 8px;
    }
    
    .tree-item:hover .item-actions {
        display: inline-block;
    }  {% endcomment %}
            
</style>
{% endblock %}

{% block content %}

<!-- location Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('location')" class="w3-bar-item w3-button">
        <i id="chevronIcon-location" class="bi bi-chevron-right"></i> location
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'location' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportlocation()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="location" class="w3-container w3-hide">
    <span class="tree-headings">
        Clients
        <i class="bi bi-chevron-right"></i><span class=tree-heading-before>Projects</span>
        <i class="bi bi-chevron-right"></i><span class=tree-heading-before>Locations</span>
        <i class="bi bi-chevron-right"></i><span class=tree-heading-before>Measurements</span>
    </span>
    {% for client in clients %}
        <div class="tree-item">
            <div class="tree-item-row">
                <!-- Client Button -->
                <button onclick="toggleOpenClose('{{ client.name }}-{{ client.id }}')" class="w3-bar-item w3-button">
                    <i id="chevronIcon-{{ client.name }}-{{ client.id }}" class="bi bi-chevron-right"></i> {{ client.name }}
                </button>               
                <!-- Client Dropdown -->
                <div class="item-actions">
                    <button class="w3-button">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <div class="w3-dropdown-content w3-bar-block w3-border">
                        <a href="#" class="w3-bar-item w3-button"><i class="bi bi-plus"></i> Add</a>
                        <a href="#" class="w3-bar-item w3-button"><i class="bi bi-pencil"></i> Edit</a>
                        <a href="#" class="w3-bar-item w3-button"><i class="bi bi-trash"></i> Delete</a>
                    </div>
                </div>
            </div>
            <div id="{{ client.name }}-{{ client.id }}" class="w3-container w3-hide">
                {% for project in client.projects.all %}
                <div class="tree-item">
                    <button onclick="toggleOpenClose('{{ project.name }}-{{ project.id }}')" class="w3-bar-item w3-button">
                        <i id="chevronIcon-{{ project.name }}-{{ project.id }}" class="bi bi-chevron-right"></i> {{ project.name }} ({{ project.get_project_type_display }})
                    </button>
                    <div id="{{ project.name }}-{{ project.id }}" class="w3-container w3-hide">
                        {% for location in project.locations.all %}
                            <div class="tree-item">
                                <button onclick="toggleOpenClose('{{ location.name }}-{{ location.id }}')" class="w3-bar-item w3-button">
                                    <i id="chevronIcon-{{ location.name }}-{{ location.id }}" class="bi bi-chevron-right"></i> {{ location.name }}
                                </button>
                                <div id="{{ location.name }}-{{ location.id }}" class="w3-container w3-hide">
                                {% for measurement in location.measurements.all %}
                                    <div class="tree-item">
                                        <button onclick="toggleOpenClose('{{ measurement.name }}-{{ measurement.id }}')" class="w3-bar-item w3-button">
                                            <i id="{{ measurement.name }}-{{ measurement.id }}"></i> {{ measurement.name }}
                                        </button>
                                        <div id="{{ measurement.name }}-{{ measurement.id }}" class="w3-container w3-hide">
                                        </div>
                                    </div>
                                {% endfor %}
                                </div>           
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>


<!-- Measurement Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('measurement')" class="w3-bar-item w3-button">
        <i id="chevronIcon-measurement" class="bi bi-chevron-right"></i> measurement
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'measurement' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportmeasurement()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="measurement" class="w3-container w3-hide">
    <p>Some text about measurement.</p>
</div>

<!-- Data Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('data')" class="w3-bar-item w3-button">
        <i id="chevronIcon-data" class="bi bi-chevron-right"></i> data
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'data' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdata()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="data" class="w3-container w3-hide">
    <p>Some text about data.</p>
</div>

<!-- Dictionary Section -->
<div class="w3-bar w3-white w3-margin-bottom w3-bottombar">   
    <button onclick="toggleOpenClose('dictionary')" class="w3-bar-item w3-button">
        <i id="chevronIcon-dictionary" class="bi bi-chevron-right"></i> dictionary
    </button>
    <div class="w3-dropdown-hover w3-right">
        <button class="w3-button">
            <i class="bi bi-three-dots-vertical"></i>
        </button>
        <div class="w3-dropdown-content w3-bar-block w3-border">
            <a href="{% url 'dictionary' %}" class="w3-bar-item w3-button">
                <i class="bi bi-box-arrow-up-right"></i> Full Page
            </a>
            <a href="#" onclick="exportdictionary()" class="w3-bar-item w3-button">
                <i class="bi bi-file-earmark-arrow-down"></i> Export
            </a>
        </div>
    </div>
</div>
<div id="dictionary" class="w3-container w3-hide">
    <p>Some text about dictionary.</p>
</div>


{% endblock %}

{% block extra_js %}
<script>
    function toggleOpenClose(id) {
        var div = document.getElementById(id);
        var icon = document.getElementById('chevronIcon-' + id);
        if (div.classList.contains("w3-show")) {
            div.classList.remove("w3-show");
            div.classList.add("w3-hide");
            icon.className = "bi bi-chevron-right";
        } else {
            div.classList.remove("w3-hide");
            div.classList.add("w3-show");
            icon.className = "bi bi-chevron-down";
        }
    }


</script>
{% endblock %}
